---
// Bouton sticky qui apparaît après scroll
---

<div id="sticky-cta" class="fixed bottom-6 right-6 z-50 opacity-0 translate-y-4 transition-all duration-300 pointer-events-none">
  <a 
    href="#simulateur"
    class="group flex items-center gap-3 bg-gradient-to-r from-primary-600 to-primary-700 text-white px-5 py-3.5 rounded-2xl shadow-lg hover:shadow-glow-green transition-all duration-300 hover:-translate-y-1"
    aria-label="Ouvrir le simulateur d'économies"
  >
    <!-- Icône calculatrice animée -->
    <div class="relative">
      <svg 
        class="w-6 h-6 transition-transform group-hover:scale-110" 
        fill="none" 
        viewBox="0 0 24 24" 
        stroke="currentColor" 
        stroke-width="2"
      >
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
      </svg>
      <!-- Pulse animation -->
      <span class="absolute -top-1 -right-1 w-3 h-3 bg-solar-400 rounded-full animate-ping"></span>
      <span class="absolute -top-1 -right-1 w-3 h-3 bg-solar-400 rounded-full"></span>
    </div>
    
    <!-- Texte -->
    <div class="hidden sm:block">
      <span class="block text-sm font-bold leading-tight">Calculer mes économies</span>
      <span class="block text-xs text-primary-200 leading-tight">Simulation gratuite 30 sec</span>
    </div>
    
    <!-- Flèche -->
    <svg 
      class="w-4 h-4 hidden sm:block transition-transform group-hover:translate-x-1" 
      fill="none" 
      viewBox="0 0 24 24" 
      stroke="currentColor" 
      stroke-width="2"
    >
      <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
    </svg>
  </a>
</div>

<script>
  const stickyCta = document.getElementById('sticky-cta');
  const simulatorSection = document.getElementById('simulateur');
  
  if (stickyCta) {
    let lastScrollY = window.scrollY;
    let ticking = false;
    
    function updateStickyVisibility() {
      const scrollY = window.scrollY;
      const windowHeight = window.innerHeight;
      const showThreshold = windowHeight * 0.5; // Apparaît après 50vh de scroll
      
      // Vérifier si on est dans la section simulateur (pour masquer le bouton)
      let isInSimulator = false;
      if (simulatorSection) {
        const rect = simulatorSection.getBoundingClientRect();
        isInSimulator = rect.top < windowHeight && rect.bottom > 0;
      }
      
      if (scrollY > showThreshold && !isInSimulator) {
        stickyCta.classList.remove('opacity-0', 'translate-y-4', 'pointer-events-none');
        stickyCta.classList.add('opacity-100', 'translate-y-0', 'pointer-events-auto');
      } else {
        stickyCta.classList.add('opacity-0', 'translate-y-4', 'pointer-events-none');
        stickyCta.classList.remove('opacity-100', 'translate-y-0', 'pointer-events-auto');
      }
      
      ticking = false;
    }
    
    function onScroll() {
      lastScrollY = window.scrollY;
      
      if (!ticking) {
        window.requestAnimationFrame(() => {
          updateStickyVisibility();
          ticking = false;
        });
        
        ticking = true;
      }
    }
    
    window.addEventListener('scroll', onScroll, { passive: true });
    
    // Check initial state
    updateStickyVisibility();
  }
</script>
